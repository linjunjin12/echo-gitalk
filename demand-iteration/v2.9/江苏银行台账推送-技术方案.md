[toc]

# 江苏银行台账数据推送-技术方案

## 1. 表结构

- 新增推送记录表

```sql
CREATE TABLE db_primary_market.`t_ledger_push_record` (
  `Fid` bigint(21) unsigned NOT NULL AUTO_INCREMENT COMMENT '自增id',
  `Fpush_status` int(4) NOT NULL COMMENT '推送状态：0-失败；1-成功',
  `Fretry_count` int(4) NOT NULL DEFAULT 0 COMMENT '重试次数',
  `Fpush_type` int(4) NOT NULL DEFAULT 0 COMMENT '0-自动推送;1-手工推送',
  `Fledger_start_time` timestamp NOT NULL COMMENT '台账数据开始时间',
  `Fledger_end_time` timestamp NOT NULL COMMENT '台账数据结束时间',
  `Fdata_days` int(4) NOT NULL DEFAULT 1 COMMENT '推送的台账数据天数(0-数据为空)',
  `Fcreate_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `Fupdate_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`Fid`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='台账推送记录表';




```

- 新增上传文件详情表

  ```sql
  CREATE TABLE db_primary_market.`t_upload_file_detail` (
    `Fid` bigint(21) unsigned NOT NULL AUTO_INCREMENT COMMENT '自增id',
    `Fbiz_id` bigint(21) unsigned NOT NULL COMMENT '文件所属业务表id',
    `Furl` varchar(128) NOT NULL COMMENT '文件访问地址',
    `Ffile_size` int(8) NOT NULL DEFAULT 0 COMMENT '文件大小，单位字节',
    `Ffile_name` varchar(128) NOT NULL COMMENT '文件名',
    `Fplatform` varchar(128) NOT NULL COMMENT '上传平台：cos-1;sftp-1',
    `Fcreate_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `Fupdate_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
    PRIMARY KEY (`Fid`)
  ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='上传文件详情表';
  ```

  

## 2. 手工/定时推送台账数据流程图

![定时_手工推送台账数据流程图](../../_media/V2.9/定时_手工推送台账数据流程图.png  ':size=50%')



## 3. 问题记录

1. 数据为空是否需要推送

2. 文件命名规则

   