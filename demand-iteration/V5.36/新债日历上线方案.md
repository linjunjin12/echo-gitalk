[toc]



## 1.需求文档

### 1.1 需求文档地址

[新债日历上线方案](https://www.tapd.cn/62488930/prong/stories/view/1162488930001014130?url_cache_key=from_url_iteration_list_0409fca0abfbf79af454a7800e90ae7c&action_entry_type=stories)

## 2. 系统方案设计

### 2.1 `erp`去除 是否QTO、是否新债日历

- 新增分组：
  - 分组绑定了`appId` --> `PRO`
  - 分组内有投标相关权限的用户 ---> `PRO`
  - 其他情况 --> `QTO`
  - 当分组为`QTO`时，关闭公告券、未公告券、DT标书应用、DT指导同步、DT发行结果同步开关
  - 是否新债日历--->默认为是


- 修改分组
  - 不实时更新分组版本



### 2.3 分组升降级跑批处理

#### 2.3.1 新增分组升降级记录表

```mysql
CREATE TABLE `t_tenant_relegation_record` (
  `Fid` bigint(21) unsigned NOT NULL AUTO_INCREMENT COMMENT '自增id',
  `Ftenant_id` bigint(19) unsigned NOT NULL COMMENT '本方分组id',
  `Fbefore_level` int(8) NOT NULL COMMENT '变更前级别：1-QTO；2-PRO',
  `Fafter_level` int(8) NOT NULL COMMENT '变更后级别：1-QTO；2-PRO',
  `Frecord_date` date NOT NULL COMMENT '记录日期',
  `Fcreate_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `Fupdate_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`Fid`),
  UNIQUE KEY `idx_tenant_id_date` (`Ftenant_id`, `Frecord_date`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT='分组升降级记录表';
```

#### 2.3.2 分组升降级跑批处理流程

![分组升降级跑批处理流程](../../_media/V5.36/根据用户权限动态切换分组版本流程图 (1).jpg)