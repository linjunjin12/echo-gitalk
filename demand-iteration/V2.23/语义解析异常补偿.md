

### component

- 复用 `@RabbitMqReceiver` 功能
- 修改点：
  - `RabbitMqReceive`r新增自定义`service`，处理保存逻辑；（`insert` ... `on` `duplicate` `update`）
  - 新增 `exchange`、`routingkey`
  - 修改发送消息逻辑，消息头携带==补偿消息标识==，发送到指定 `exchagne`，`routingkey`



## chat-parse

### 新增异常消息表

```mysql
CREATE TABLE `t_abnormal_message` (
  `Fid` bigint(19) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键，自增',
  `Fmessage_id` varchar(50) NOT NULL DEFAULT '' COMMENT '消息id',
  `Fexchange` varchar(100)  NOT NULL DEFAULT '' COMMENT '交换机',
  `Frouting_key` varchar(100) NOT NULL DEFAULT '' COMMENT '路由key',
  `Fmessage_body` longtext COMMENT '消息体',
  `Fmessage_content` longtext COMMENT '消息内容',
  `Fauto_refresh_flag` int(1) NOT NULL DEFAULT '0' COMMENT '是否自动重刷',
  `Fcreated_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `Fupdated_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`Fid`),
  UNIQUE KEY `idx_message_id` (`Fmessage_id`),
  KEY `idx_auto_refresh` (`Fauto_refresh_flag`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COMMENT='异常消息表';
```

### 语义解析异常兜底流程
![语义解析异常兜底流程](../../_media/V2.23/语义解析异常兜底流程.png)




​	