[toc]



## `Chat-parse`

### 旧消息链路流程图
![旧消息链路流程](../../_media/V5.12/旧消息链路流程.png ':size=50%')

### 新消息链路流程图
![新消息链路流程](../../_media/V5.12/新消息链路流程.png ':size=50%')

### 前置条件判断 `dubbo` 接口
![前置条件判断](../../_media/V5.12/投前isParse接口修改.png ':size=20%')
### `nlp `新接口调用及参数适配
- 广告
- 指导
- 发行结果


## `Bond-sale`

开发时根据新、旧参数是否适配来决定是否需要修改接收解析结果MQ逻辑



## 数据对比表

```sql
CREATE TABLE `t_nlp_parse_result_gray_record` (
  `Fid` bigint(21) unsigned NOT NULL AUTO_INCREMENT COMMENT '自增Id',
  `Fmessage_id` varchar(128) NOT NULL COMMENT '消息Id',
  `Fparse_result` mediumtext COMMENT '债券数据包含子表信息',
  `Fcreate_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `Fupdate_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`Fid`),
  KEY `index_message_id` (`Fmessage_id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='nlp解析结果灰度比对表';
```





## 待确认问题

- [ ] 一个消息解析出多个分类，所有分类都配置相关的routingKey，会发送一次还是多次消息